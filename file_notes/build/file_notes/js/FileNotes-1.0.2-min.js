EPICOR.namespace("EPICOR.IMR.FileNotes");EPICOR.IMR.FileNotes=(function(){var b,d={},a,c={URL_FILE_NOTES_HTML:"/epicor/shared/file_notes/fn.html",URL_POST_FILE_NOTE:"",URL_FILE_NOTE_CONTENT:"/IMDBMiddlewareService/api/imr/content/comment",URL_FILE_NOTE_DATASOURCE:"/IMDBMiddlewareService/api/imr/general/itemDataSource/comment",URL_FILE_NOTE_SUPPLIER_LINE:"/IMDBMiddlewareService/api/imr/supplierMaint/desc/comments",URL_FILE_NOTE_SUPPLIER:"/IMDBMiddlewareService/api/imr/supplierMaint/supplier/comments",URL_FILE_NOTE_RULE:"/IMDBMiddlewareService/api/imr/supplierMaint/rule/comments",CSS_MODULE_CONTAINER:"fn_container",CSS_NOTES_AREA:"comment-text-area",NOTE_BAR_CLICK_EVENT:"NoteBarClick",QUESTION_ICON_CLASS:"question-icon",QUESTION_ICON:"/epicor/shared/images/question-medium.png",DIALOG_MESSAGE:"dialog-message",CSS_NOTES_BUTTONS_CONTAINER:"notes_buttons",CSS_NOTES_POST_BUTTON:"comment_post",CSS_NOTES_CLEAR_BUTTON:"comment_clear",CSS_ADD_BUTTON:"comment_post",CSS_CLEAR_BUTTON:"comment_clear",MSG_ELEMENT_IN_DOM:"Element must be in the DOM."};var e=function(g,j,f,h){a=$("<div>").addClass(c.CSS_MODULE_CONTAINER);f=f||{};$.extend(true,c,f);try{b=new EPICOR.IMR.FileNotes.Controller(c,new EPICOR.IMR.FileNotes.Model(c,g,j),new EPICOR.IMR.FileNotes.View(c,a));b.init();}catch(i){}};e.prototype={constructor:EPICOR.IMR.FileNotes,vendor:"Epicor Software Corporation",authors:"Kevin Torbett/Timothy Graf",version:"1.0.2",date:"January 13, 2015 11:05:52",name:"File Notes",cleanUp:function(){b.cleanUp();b=null;a=null;c=null;},showFileNotes:function(g,f){return b.showFileNotes(g,f);},getContent:function(){return a;},on:function(f,g){a.on(f,g);},off:function(f,g){a.off(f,g);}};return e;}());EPICOR.namespace("EPICOR.IMR.FileNotes.Controller");EPICOR.IMR.FileNotes.Controller=function(f,e,b){if(!(this instanceof EPICOR.IMR.FileNotes.Controller)){return new EPICOR.IMR.FileNotes.Controller(f,e,b);}var a,c,h,d;function g(j,k){var m;var i=$.Deferred();switch(k.button){case f.CSS_NOTES_CLEAR_BUTTON:b.clearNotesTextArea();break;case f.CSS_NOTES_POST_BUTTON:var l=$(".comment-text-area").val();m=e.addNote(h,l,d);m.done(function(){e.getFileNotesData(h,d).done(function(n){b.buildCommentContainer(n);});m.done(function(){i.resolve();});}).fail(function(){i.reject();});m.fail(function(n){b.showUpdateErrorDialog(n,"Error adding Note");});b.clearNotesTextArea();break;}}c={init:function(){var i;$(b).on(f.NOTE_BAR_CLICK_EVENT,g);},showFileNotes:function(i,k){h=i;d=k;var j=$.Deferred();var l;l=e.getDataFileNotesHtml();l.done(function(m){b.setFileNotesHtml(m);});e.getFileNotesData(i,d).done(function(m){b.buildCommentContainer(m);}).fail(function(){j.reject();});l.done(function(){j.resolve();});return j;},cleanUp:function(){b.cleanUp();e.cleanUp();a=null;c=null;}};a={};a={};return c;};EPICOR.namespace("EPICOR.IMR.FileNotes.View");EPICOR.IMR.FileNotes.View=function(d,c){if(!(this instanceof EPICOR.IMR.FileNotes.View)){return new EPICOR.IMR.FileNotes.View(d,c);}var a,f,h,i,j,e;function b(){h=c.find("."+d.CSS_NOTES_AREA);i=c.find("."+d.CSS_NOTES_BUTTONS_CONTAINER);j=c.find("."+d.CSS_ADD_BUTTON);e=c.find("."+d.CSS_CLEAR_BUTTON);j.button();e.button();c.on("click","button",function(m){m.preventDefault();var n=$(m.currentTarget).attr("class"),k=n.split(" "),l;if(k.length>=2){l=k[1].trim();}$(a).trigger(d.NOTE_BAR_CLICK_EVENT,{button:l});});}function g(l){var k=EPICOR.IMR.Formatter.formatUTCDateTime(l.receiveDate);return'<div class="ui-widget-content ui-corner-all comment"><div>'+l.text+'</div><div class="comment-footer"><span>Posted by: '+l.userAdded+"</span><span> on "+k+"</span></div></div>";}a={cleanUp:function(){a=null;f=null;h=null;i=null;j=null;e=null;},setController:function(k){f=k;},setFileNotesHtml:function(k){c.html(k);b();},clearNotesTextArea:function(){h.val("");},buildCommentContainer:function(m){c.find(".comment_list").html("");var n="";var l=m.totalCount;if(l>0){for(var k=0;k<l;k++){n+=g(m.items[k]);}}c.find(".comment_list").append(n);},showUpdateErrorDialog:function(m,n){var l,k=$.Deferred();l=new EPICOR.IMR.DialogFactory.factory(EPICOR.IMR.DialogFactory.ModalType);if(n){l.setTitle(n);}else{l.setTitle("Update Error");}l.setContent($('<img class="'+d.QUESTION_ICON_CLASS+'" src="'+d.QUESTION_ICON+'"><div class="'+d.DIALOG_MESSAGE+'">'+m.responseText+"</p></div>"));l.on("ok",function(){k.resolve();});l.open();return k.promise();}};return a;};EPICOR.namespace("EPICOR.IMR.FileNotes.Model");EPICOR.IMR.FileNotes.Model=function(c,d,i){if(!(this instanceof EPICOR.IMR.FileNotes.Model)){return new EPICOR.IMR.FileNotes.Model();}var h=location.protocol+"//"+location.host,a,g;function f(j,k){return $.ajax({url:h+j,type:"GET",cache:false,beforeSend:function(l){l.setRequestHeader("Authorization",d);l.setRequestHeader("Authorization-Application",i);},data:k,contentType:"text/json",dataType:"json"});}function b(j,k){return $.ajax({url:h+j,type:"PUT",cache:false,beforeSend:function(l){l.setRequestHeader("Authorization",d);l.setRequestHeader("Authorization-Application",i);},data:k,contentType:"text/json",dataType:"json"});}function e(j,k){return $.ajax({url:h+j,type:"POST",cache:false,beforeSend:function(l){l.setRequestHeader("Authorization",d);l.setRequestHeader("Authorization-Application",i);},data:k,contentType:"text/json",dataType:"json"});}a={init:function(l,k,j){c=l;d=k;i=j;},cleanUp:function(){h=null;a=null;},getDataFileNotesHtml:function(){return $.get(h+c.URL_FILE_NOTES_HTML);},getFileNotesData:function(k,j){if(j==="d"){return f(c.URL_FILE_NOTE_DATASOURCE,{order:"asc",sort:"id",searchCriteria:'[{"searchType":"eq","values":["'+k+'"],"field":"itemDataSourceId"}]'});}else{if(j==="c"){return f(c.URL_FILE_NOTE_CONTENT,{order:"asc",sort:"id",searchCriteria:'[{"searchType":"eq","values":["'+k+'"],"field":"contentId"}]'});}else{if(j==="s"){return f(c.URL_FILE_NOTE_SUPPLIER,{order:"asc",sort:"id",searchCriteria:'[{"searchType":"eq","values":["'+k+'"],"field":"supplierId"}]'});}else{if(j==="r"){return f(c.URL_FILE_NOTE_RULE,{order:"asc",sort:"id",searchCriteria:'[{"searchType":"eq","values":["'+k+'"],"field":"ruleId"}]'});}else{if(j==="l"){return f(c.URL_FILE_NOTE_SUPPLIER_LINE,{order:"asc",sort:"id",searchCriteria:'[{"searchType":"eq","values":["'+k+'"],"field":"suppContentDescId"}]'});}else{return f(c.URL_FILE_NOTE_DATASOURCE,{order:"asc",sort:"id",searchCriteria:'[{"searchType":"eq","values":["'+k+'"],"field":"itemDataSourceId"}]'});}}}}}},addNote:function(m,l,j){var k=l;k=k.replace(/"/g,"&quot;");k=k.replace(/'/g,"&apos;");if(j==="d"){return e(c.URL_FILE_NOTE_DATASOURCE,'[{itemDataSourceId:"'+m+'",text:"'+k+'"}]');}else{if(j==="c"){return e(c.URL_FILE_NOTE_CONTENT,'[{contentId:"'+m+'",text:"'+k+'"}]');}else{if(j==="l"){return e(c.URL_FILE_NOTE_SUPPLIER_LINE,'[{suppContentDescId:"'+m+'",text:"'+k+'"}]');}else{if(j==="s"){return e(c.URL_FILE_NOTE_SUPPLIER,'[{supplierId:"'+m+'",text:"'+k+'"}]');}else{if(j==="r"){return e(c.URL_FILE_NOTE_RULE,'[{ruleId:"'+m+'",text:"'+k+'"}]');}else{return e(c.URL_FILE_NOTE_CONTENT,'[{contentId:"'+m+'",text:"'+k+'"}]');}}}}}}};return a;};